
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>[HD] #11897 XJMF Communication between TP and UWRW</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <link rel="stylesheet" href="_static/roles.css" type="text/css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
          

          <div class="body" role="main">
            
  <section id="order3-hd-xjmf-communication-between-tp-and-uw-rw-made-by-company-ho">
<h1><strong>#11897_Order3 [HD] XJMF communication between TP and UW/RW made by Company Ho</strong><a class="headerlink" href="#order3-hd-xjmf-communication-between-tp-and-uw-rw-made-by-company-ho" title="Permalink to this heading">¶</a></h1>
<section id="change-log">
<h2><strong>Change log</strong><a class="headerlink" href="#change-log" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Rev.</p></th>
<th class="head"><p>Date</p></th>
<th class="head"><p>Author</p></th>
<th class="head"><p>Details</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>1</strong></p></td>
<td><p>2023/01/31</p></td>
<td><p>GCS</p></td>
<td><p>Created</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
</section>
<section id="target-system">
<h2><strong>Target System</strong><a class="headerlink" href="#target-system" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><p>TP-J520HD V3.??JXD0xx</p>
</div></blockquote>
<section id="note-for-diagrams">
<h3><strong>Note for diagrams</strong><a class="headerlink" href="#note-for-diagrams" title="Permalink to this heading">¶</a></h3>
<blockquote>
<div><p class="plantuml">
<img src="_images/plantuml-9366913da2609670da9590e5423e37c40b143d0d.png" alt="&#64;startuml images\noteDiagram.png
legend left
    |=Note for colors in diagram|
    |&lt;back:Yellow&gt;Updated source code&lt;/back&gt;|
    |&lt;back:Green&gt;New source code&lt;/back&gt;|
    |&lt;back&gt;Old source code&lt;/back&gt;|
    |&lt;back:red&gt;&lt;strike&gt;Deleted source code|
endlegend
&#64;enduml"/>
</p>
</div></blockquote>
</section>
</section>
<section id="inquires-about-the-web-tension-information-operation-panel-settings-when-the-test-button-is-pressed-store-temporary-specification-of-505">
<h2><strong>【503】. Inquires about the web tension information (operation panel settings) when the test button is pressed. Store (※ Temporary specification of 【505】).</strong><a class="headerlink" href="#inquires-about-the-web-tension-information-operation-panel-settings-when-the-test-button-is-pressed-store-temporary-specification-of-505" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><dl>
<dt><strong>1. Description</strong></dt><dd><p>【503-01】</p>
<div class="line-block">
<div class="line">Temporarily create a web tension inquiry test button on the TP system printing condition setting screen.When this button is pressed, it will be provisionally implemented so that the 【500-01】 “QueryResource” command is sent to each of UW and Also, it receives the response at this time, and stores the received web tension information in the printing conditions as shown in 【500-03】.</div>
</div>
<blockquote>
<div><ul class="simple">
<li><p>When the button is pressed, the print conditions at the save destination are set to the “current  print conditions”.</p></li>
<li><p>※Since this test button will be deleted when responding to the next “Requirement 4”, it can be a temporary implementation. The position and design of the button does not matter. A design that does not require man-hours is good.</p></li>
</ul>
</div></blockquote>
<p>【503-02】</p>
<p><a href="#id1"><span class="problematic" id="id2">|</span></a>If there is no response from the UW/RW when inquiring about the above web tension information, or if there is an error response (returnCode is other than 0), the following warning message dialog will be displayed.</p>
<blockquote>
<div><ul>
<li><p>At this time, the following warning message dialog is displayed.</p>
<blockquote>
<div><ul>
<li><p>For UW</p>
<blockquote>
<div><ul class="simple">
<li><p>(Ja) UWとの通信エラーが発生しました。UWのウェブテンションの取得に失敗しました。</p></li>
<li><p>(En) A communication error with UW has occurred. Failed to get UW web tension.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>For RW</p>
<blockquote>
<div><ul class="simple">
<li><p>(Ja) RWとの通信エラーが発生しました。RWのウェブテンションの取得に失敗しました。</p></li>
<li><p>(En) A communication error with UW has occurred. Failed to get RW web tension.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</dd>
</dl>
<p><strong>2. Solution</strong></p>
<ul class="simple">
<li><p>Rename plugin UnwinderManager to UwRwManager.</p></li>
<li><p>In plugin UwRwManager, replace “Uw” in classes name by “UwRw”.</p></li>
<li><p>In plugin UwRwManager, replace “Uw” in methods name by “UwRw”.</p></li>
<li><p>in class CRequestUwRwThread, add variable to store name of UW or RW.</p></li>
</ul>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">dataIF.h</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// before</span>
<span class="n">UINT</span><span class="w"> </span><span class="n">m_PaperReceivingTimeId</span><span class="p">;</span><span class="w"></span>
<span class="n">UINT</span><span class="w"> </span><span class="n">m_StatusReceivingTimeId</span><span class="p">;</span><span class="w"></span>

<span class="c1">// after</span>
<span class="n">UINT</span><span class="w"> </span><span class="n">m_PaperReceivingTimeId</span><span class="p">;</span><span class="w"></span>
<span class="n">UINT</span><span class="w"> </span><span class="n">m_StatusReceivingTimeId</span><span class="p">;</span><span class="w"></span>
<span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">m_DeviceName</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</div>
<p><strong>3. Detail implementation</strong></p>
<blockquote>
<div><p class="plantuml">
<img src="_images/plantuml-15228600aa5046b1dbfc4027d573e6b3e6fd3e66.png" alt="&#64;startuml
skinparam noteBackgroundColor #DDDDDD
skinparam noteBorderColor #666666

autonumber &quot;&lt;b&gt;[000]&quot;
hide footbox
TITLE 100.1 Initialize variable

participant CWriteDebugLog as main
-&gt;main++: CRequestUwRwThread(const char* inDevicename)
    NOTE OVER OF main
        Old implement
    END NOTE
    NOTE OVER OF main #green
        m_DeviceName(inDevicename)
    END NOTE
    NOTE OVER OF main
        Old implement
    END NOTE
&lt;--main--:
&#64;enduml"/>
</p>
</div></blockquote>
</div></blockquote>
</section>
<section id="xml-output-of-send-and-receive-contents">
<h2><strong>103. Xml output of send and receive contents</strong><a class="headerlink" href="#xml-output-of-send-and-receive-contents" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><dl>
<dt><strong>1. Description</strong></dt><dd><p>103-01.</p>
<p>Place the xml output of the sent / received contents directly under the folder in the following path.</p>
<blockquote>
<div><ul class="simple">
<li><p>D:\TPJ_xx\Client_xx\Log\UW_CONNECT\yyyymmdd.xml</p></li>
<li><p>D:\TPJ_xx\Client_xx\Log\RW_CONNECT\yyyymmdd.xml</p></li>
</ul>
</div></blockquote>
<p>103-02.</p>
<p>The output xml file is automatically deleted after a certain period of time.</p>
<blockquote>
<div><ul class="simple">
<li><p>UWandRW_Receiver.exe checks the above storage period at startup and deletes it if necessary.</p></li>
<li><p>The retention period of the xml file is defined in the “TP-UWRW_Communication.ini” file.</p></li>
</ul>
</div></blockquote>
</dd>
</dl>
<p><strong>2. Solution</strong></p>
<blockquote>
<div><ul class="simple">
<li><p>In class CWriteDebugLog, add variable to store log folder path for RW.</p></li>
</ul>
<blockquote>
<div><div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">UWandRW_Receiver\WriteDebugLog.h</span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// before</span>
<span class="n">CString</span><span class="w">     </span><span class="n">m_strFileName</span><span class="p">;</span><span class="w">      </span><span class="c1">//!&lt; ログ出力フォルダの日付</span>
<span class="n">CString</span><span class="w">     </span><span class="n">m_strDate</span><span class="p">;</span><span class="w">          </span><span class="c1">//!&lt; ログ出力フォルダの日付</span>
<span class="n">CString</span><span class="w">     </span><span class="n">m_strOutputPath</span><span class="p">;</span><span class="w">    </span><span class="c1">//!&lt; ログ出力ファイルパス</span>

<span class="c1">// after</span>
<span class="n">CString</span><span class="w">     </span><span class="n">m_strFileName</span><span class="p">[</span><span class="n">DEF_MAX_LOG_FOLDER</span><span class="p">];</span><span class="w">      </span><span class="c1">//!&lt; ログ出力フォルダの日付</span>
<span class="n">CString</span><span class="w">     </span><span class="n">m_strDate</span><span class="p">[</span><span class="n">DEF_MAX_LOG_FOLDER</span><span class="p">];</span><span class="w">          </span><span class="c1">//!&lt; ログ出力フォルダの日付</span>
<span class="n">CString</span><span class="w">     </span><span class="n">m_strOutputPath</span><span class="p">[</span><span class="n">DEF_MAX_LOG_FOLDER</span><span class="p">];</span><span class="w">    </span><span class="c1">//!&lt; ログ出力ファイルパス</span>
</pre></div>
</div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>In method CWriteDebugLog::InitializeXml, append set log folder path for RW.</p></li>
<li><p>In method CXmlLogData::GetLogFolderPath, append create Log folder path for RW.</p></li>
<li><p>In method CMainFunction::DeleteLogFolder, append delete log folder for RW.</p></li>
</ul>
</div></blockquote>
<p><strong>3. Detail implementation</strong></p>
<blockquote>
<div><p class="plantuml">
<img src="_images/plantuml-f8fc05fdaa7cd5862c43d0ce3c318ffc6adc781f.png" alt="&#64;startuml
skinparam noteBackgroundColor #DDDDDD
skinparam noteBorderColor #666666

autonumber &quot;&lt;b&gt;[000]&quot;
hide footbox
TITLE 103.1 Initialize log folder path for RW

participant CWriteDebugLog as main
-&gt;main++: Initialize( const CString&amp; inFileName )
    NOTE OVER OF main
        Old implement
    END NOTE
    NOTE OVER OF main #red
        &lt;strike&gt;m_strFileName = inFileName;

        &lt;strike&gt;// ログ出力ファイル
        &lt;strike&gt;CString OutputFolder = CCommon::GetModuleDirectory() + &quot;\\Log&quot;;
        &lt;strike&gt;if (!::PathFileExists(OutputFolder))
        &lt;strike&gt;{   // 存在しない場合はフォルダを作成する
        &lt;strike&gt;    ::SHCreateDirectory(NULL, A2W(OutputFolder.GetString()));
        &lt;strike&gt;}
        &lt;strike&gt;// ログファイルパス
        &lt;strike&gt;m_strOutputPath = OutputFolder + &quot;\\&quot; + m_strFileName;
    END NOTE
    LOOP &lt;color green&gt; int index = 0; index &lt; DEF_MAX_LOG_FOLDER; index++
        NOTE OVER OF main #green
            // ログ出力日付
            m_strFileName[index] = inFileName;

            // ログ出力ファイル
            CString OutputFolder = CCommon::GetModuleDirectory() + &quot;\\Log&quot;;
            if (!::PathFileExists(OutputFolder))
            {       // 存在しない場合はフォルダを作成する
                ::SHCreateDirectory(NULL, A2W(OutputFolder.GetString()));
            }
            // ログファイルパス
            m_strOutputPath[index] = OutputFolder + &quot;\\&quot; + m_strFileName;
        END NOTE
    END
&lt;--main--:
&#64;enduml"/>
</p>
<p class="plantuml">
<img src="_images/plantuml-d3c553934f4390de463aea7d88490af50b62c247.png" alt="&#64;startuml
skinparam noteBackgroundColor #DDDDDD
skinparam noteBorderColor #666666

autonumber &quot;&lt;b&gt;[000]&quot;
hide footbox
TITLE 103.2 Set log folder path for RW

participant CWriteDebugLog as main
-[#green]&gt;main++: InitializeXml( const CString&amp; inFileName, const char* inDeviceName)
    NOTE OVER OF main
        Old implement
    END NOTE
    NOTE OVER OF main #red
        &lt;strike&gt;m_strFileName[index] = inFileName;

        &lt;strike&gt;// ログ出力ファイル
        &lt;strike&gt;CString OutputFolder = CCommon::GetModuleDirectory() + &quot;\\Log\\&quot; + inDeviceName + &quot;_CONNECT\\&quot; + CGetTime::GetStrDate() + &quot;.xml&quot;;
        &lt;strike&gt;if ( !::PathFileExists( OutputFolder ) )
        &lt;strike&gt;{   // 存在しない場合はフォルダを作成する
        &lt;strike&gt;    ::SHCreateDirectory( NULL, A2W(OutputFolder.GetString()) );
        &lt;strike&gt;}
        &lt;strike&gt;// ログファイルパス
        &lt;strike&gt;m_strOutputPath[index] = OutputFolder + &quot;\\&quot; + m_strFileName[index];
    END NOTE
    NOTE OVER OF main #green
        int index = strcmp(inDeviceName, DEF_UW) ? 1 : 0;
        // ログ出力日付
        m_strFileName[index] = inFileName;

        // ログ出力ファイル
        CString OutputFolder = CCommon::GetModuleDirectory() + &quot;\\Log\\&quot; + inDeviceName + &quot;_CONNECT\\&quot; + CGetTime::GetStrDate() + &quot;.xml&quot;;
        if ( !::PathFileExists( OutputFolder ) )
        {   // 存在しない場合はフォルダを作成する
            ::SHCreateDirectory( NULL, A2W(OutputFolder.GetString()) );
        }
        // ログファイルパス
        m_strOutputPath[index] = OutputFolder + &quot;\\&quot; + m_strFileName[index];
    END NOTE
&lt;--main--:
&#64;enduml"/>
</p>
<p class="plantuml">
<img src="_images/plantuml-06d3b0747a65087102e686bc2946e2514819c23a.png" alt="&#64;startuml
skinparam noteBackgroundColor #DDDDDD
skinparam noteBorderColor #666666

autonumber &quot;&lt;b&gt;[000]&quot;
hide footbox
TITLE 103.3 Write debug log for RW

participant CWriteDebugLog as main
-[#green]&gt;main++: WriteDebuglog( const CString&amp; inStrLogInfo, \nE_LOG_LEVEL inDebugLevel, BOOL inTime , const char* inDeviceName)
    NOTE OVER OF main
        Old implement
    END NOTE
    NOTE OVER OF main #red
        &lt;strike&gt;fopen_s(&amp;fpTest, m_strOutputPath, _T(&quot;a&quot;));
    END NOTE
    NOTE OVER OF main #green
        fopen_s(&amp;fpTest, m_strOutputPath[strcmp(inDeviceName, DEF_UW) ? 1 : 0], _T(&quot;a&quot;));
    END NOTE
    NOTE OVER OF main
        Old implement
    END NOTE
&lt;--main--:
&#64;enduml"/>
</p>
<p class="plantuml">
<img src="_images/plantuml-cdecfdf251e746071dcef42803aa17b979443d34.png" alt="&#64;startuml
skinparam noteBackgroundColor #DDDDDD
skinparam noteBorderColor #666666

autonumber &quot;&lt;b&gt;[000]&quot;
hide footbox
TITLE 103.4 Get log folder path

participant CXmlLogData as main
-[#green]&gt;main++: &lt;color green&gt;GetLogFolderPath(const char* inDeviceName)
    NOTE OVER OF main
        Old implement
    END NOTE
    NOTE OVER OF main #red
        &lt;strike&gt;LogFolderPath.append(&quot;\\LOG\\UW_CONNECT\\&quot;);
    END NOTE
    NOTE OVER OF main #green
        LogFolderPath.append(&quot;\\LOG\\&quot;);
        LogFolderPath.append(inDeviceName);
        LogFolderPath.append(&quot;_CONNECT\\&quot;);
    END NOTE
    NOTE OVER OF main
        Old implement
    END NOTE
&lt;--main--: LogFolderPath
&#64;enduml"/>
</p>
<p class="plantuml">
<img src="_images/plantuml-dde02d0732ed4afbacfd4f468f87802ec2eabb57.png" alt="&#64;startuml
skinparam noteBackgroundColor #DDDDDD
skinparam noteBorderColor #666666

autonumber &quot;&lt;b&gt;[000]&quot;
hide footbox
TITLE 103.5 Delete log folder

participant CMainFunction as main
-[#green]&gt;main++: DeleteLogFolder(CWriteDebugLog* inWriteDebugLog)
    NOTE OVER OF main #red
        &lt;strike&gt;CString LogTopFoler = CCommon::GetModuleDirectory() + &quot;\\Log\\UW_CONNECT\\&quot;;

        &lt;strike&gt;CIni_UwRwManager iniUnwinderManager;
        &lt;strike&gt;iniUnwinderManager.Initialize(TRUE);

        &lt;strike&gt;CDeleteLogFolder sDeleteLogFolder(inWriteDebugLog);
        &lt;strike&gt;sDeleteLogFolder.Doit(LogTopFoler, iniUnwinderManager.getPeriod_day());
    END NOTE
    LOOP &lt;color green&gt;int index = 0; index &lt; DEF_MAX_LOG_FOLDER; index++
        NOTE OVER OF main #green
            CString LogTopFoler = CCommon::GetModuleDirectory() + &quot;\\Log\\&quot; + ((index == 0)? DEF_UW : DEF_RW) + &quot;_CONNECT\\&quot;;

            CIni_UwRwManager iniUnwinderManager;
            iniUnwinderManager.Initialize(TRUE);

            CDeleteLogFolder sDeleteLogFolder(inWriteDebugLog);
            sDeleteLogFolder.Doit(LogTopFoler, iniUnwinderManager.getPeriod_day());
        END NOTE
    END
&lt;--main--:
&#64;enduml"/>
</p>
</div></blockquote>
</div></blockquote>
</section>
<section id="enable-disable-of-xjmf-communication-with-uw-rw">
<h2><strong>200. Enable/disable of XJMF communication with UW/RW</strong><a class="headerlink" href="#enable-disable-of-xjmf-communication-with-uw-rw" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><dl>
<dt><strong>1. Description</strong></dt><dd><p>200-01.</p>
<p>201-4xx XJMF communication specifications work only when the following key is set to 1.</p>
<blockquote>
<div><ul>
<li><p>[File name]: PrinterDescriptor.ini</p></li>
<li><p>[Section name]: OPTION</p></li>
<li><p>[Key name: 1]: UW_CONNECT_FUNCTION</p></li>
<li><p>[Key name: 2]: RW_CONNECT_FUNCTION</p>
<blockquote>
<div><ul class="simple">
<li><p>The default value for the above keys is 0.</p></li>
<li><p>Manually change to 1 during setup when communication with UW/RW made by Ho.</p></li>
<li><p>It is also possible to communicate with only one of UW and RW</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</dd>
</dl>
<p><strong>2. Solution</strong></p>
<blockquote>
<div><ul class="simple">
<li><p>In class CIni_PrinterDescriptor, add method to get value of RW_CONNECT_FUNCTION key from PrinterDescriptor.ini file.</p></li>
</ul>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">Common\Ini_PrinterDescriptor.h</span><a class="headerlink" href="#id5" title="Permalink to this code">¶</a></div>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="k">public</span><span class="o">:</span><span class="w"></span>
<span class="p">...</span><span class="w"></span>
<span class="cm">/**</span>
<span class="cm">    @brief      Get Rewinder Option</span>
<span class="cm">    @retval 1: enable RewinderManager function</span>
<span class="cm">    @retval 0: disable RewinderManager function</span>
<span class="cm">*/</span><span class="w"></span>
<span class="n">UINT</span><span class="w"> </span><span class="n">getRewinderOption</span><span class="p">();</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">Common\Ini_PrinterDescriptor.cpp</span><a class="headerlink" href="#id6" title="Permalink to this code">¶</a></div>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="n">UINT</span><span class="w"> </span><span class="nf">CIni_PrinterDescriptor::getRewinderOption</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">GetValueInt</span><span class="p">(</span><span class="s">&quot;OPTION&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;RW_CONNECT_FUNCTION&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<ul>
<li><p>In CDataIF class, add new variable to handle Rewinder thread.</p>
<blockquote>
<div><div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">Common\Ini_PrinterDescriptor.cpp</span><a class="headerlink" href="#id7" title="Permalink to this code">¶</a></div>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// before</span>
<span class="n">unwinder_manager</span><span class="o">::</span><span class="n">CRequestUwRwThread</span><span class="w"> </span><span class="n">m_RequestUnwinderThread</span><span class="p">;</span><span class="w"></span>

<span class="c1">// after</span>
<span class="n">uwrw_manager</span><span class="o">::</span><span class="n">CRequestUwRwThread</span><span class="w"> </span><span class="n">m_RequestUnwinderThread</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">uwrw_manager</span><span class="o">::</span><span class="n">CRequestUwRwThread</span><span class="w"> </span><span class="n">m_RequestRewinderThread</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</div>
</div></blockquote>
</li>
</ul>
</div></blockquote>
<p><strong>3. Detail implementation</strong></p>
<blockquote>
<div><p class="plantuml">
<img src="_images/plantuml-c6215881d24b09f7e416a8239aa85463e23c95c7.png" alt="&#64;startuml
skinparam noteBackgroundColor #DDDDDD
skinparam noteBorderColor #666666

autonumber &quot;&lt;b&gt;[000]&quot;
hide footbox
TITLE 200.1 Create thread for Query Status

participant CDataIF as main
-&gt;main++: PIM_InitSystem()
    NOTE OVER OF main
        Old implement
    END NOTE
    OPT &lt;color green&gt;m_IniPrinterDescriptor.getRewinderOption() == 1
        NOTE OVER OF main #green
           m_RequestRewinderThread.StartThread();
        END NOTE
    END
&lt;--main--: TRUE
&#64;enduml"/>
</p>
<p class="plantuml">
<img src="_images/plantuml-73739f1476949e5520d9ab3eaf92ca4ff35f6566.png" alt="&#64;startuml
skinparam noteBackgroundColor #DDDDDD
skinparam noteBorderColor #666666

autonumber &quot;&lt;b&gt;[000]&quot;
hide footbox
TITLE 200.2 Delete thread of Query Status

participant CDataIF as main
-&gt;main++: PIM_ExitSystem()
    NOTE OVER OF main #red
        Old implement
    END NOTE
    OPT &lt;color green&gt;m_IniPrinterDescriptor.getRewinderOption() == 1
        NOTE OVER OF main #green
           m_RequestRewinderThread.EndThread();
        END NOTE
    END
&lt;--main--: TRUE
&#64;enduml"/>
</p>
<p class="plantuml">
<img src="_images/plantuml-eec67a79343a327716e70cee1a8c0c16085cd11d.png" alt="&#64;startuml
skinparam noteBackgroundColor #DDDDDD
skinparam noteBorderColor #666666

autonumber &quot;&lt;b&gt;[000]&quot;
hide footbox
TITLE 200.3 Callback when job run

participant CDataIF as main
-&gt;main++: OnFirstJobRun(const std::string&amp; inSectionId)
    NOTE OVER OF main
        Old implement
    END NOTE
    OPT &lt;color green&gt;m_IniPrinterDescriptor.getRewinderOption() == 1
        NOTE OVER OF main #green
           m_RequestRewinderThread.MsgNotifyAndQueryResource(inSectionId);
        END NOTE
    END
&lt;--main--:
&#64;enduml"/>
</p>
<p class="plantuml">
<img src="_images/plantuml-ecfd2aa7ec64123d20185fa03a6b1598607e1591.png" alt="&#64;startuml
skinparam noteBackgroundColor #DDDDDD
skinparam noteBorderColor #666666

autonumber &quot;&lt;b&gt;[000]&quot;
hide footbox
TITLE 200.4 Get paper thickness

participant CDataIF as main
-&gt;main++: GetUWPaperThickness(long &amp;outThickness)
    OPT &lt;color red&gt;&lt;strike&gt;m_IniPrinterDescriptor.getUnwinderOption() == 1
    NOTE OVER OF main #red
        &lt;strike&gt;m_receiveSignalStatus.GetUWPaperThickness(outThickness);
    END NOTE
    END
    OPT &lt;color green&gt;(m_IniPrinterDescriptor.getUnwinderOption() == 1) || (m_IniPrinterDescriptor.getRewinderOption() == 1)
        NOTE OVER OF main #green
           m_receiveSignalStatus.GetUWPaperThickness(outThickness);
        END NOTE
    END
&lt;--main--:
&#64;enduml"/>
</p>
</div></blockquote>
</div></blockquote>
</section>
<section id="status-monitoring-channel-channel-registration">
<h2><strong>300. Status monitoring channel (channel registration)</strong><a class="headerlink" href="#status-monitoring-channel-channel-registration" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><p><strong>1. Description</strong></p>
<blockquote>
<div><p>300-01.</p>
<p>The controller registers the communication channel for status monitoring in order to obtain status information from UW/RW.</p>
<blockquote>
<div><ul class="simple">
<li><p>Channel registration is done for each of UW and RW.</p></li>
</ul>
</div></blockquote>
<p>300-03.</p>
<p>Channel registration is performed by notifying the UW/RW of the “QueryStatus” command by specifying Subscription from the controller.</p>
<blockquote>
<div><ul>
<li><p>For Subscription, specify the following information.</p>
<blockquote>
<div><ul class="simple">
<li><p>URL (information notification destination)</p></li>
<li><p>RepeatTime (Regular notification interval from UW/RW)</p></li>
</ul>
</div></blockquote>
</li>
<li><p>The specified value is defined in “TP-UWRW_Communication.ini”.</p></li>
</ul>
</div></blockquote>
<p>300-04.</p>
<p>If channel registration is successfully completed (returncode=0), Receive channel ID (refID) in response from UW/RW.</p>
<blockquote>
<div><ul class="simple">
<li><p>Store the received channel ID in “Status_CannelID” of “TP-UWRW_Communication_work.ini”</p></li>
</ul>
</div></blockquote>
<p>300-05.</p>
<p>If there is no channel registration result response from UW/RW, or if the channel registration result is abnormal (returncode=other than 0), it is determined that UW/RW is not activated.</p>
<blockquote>
<div><ul class="simple">
<li><p>At this time, store “” (empty value) in “Status” of “TP-UWRW_Communication_work.ini”</p></li>
</ul>
</div></blockquote>
<p>300-06.</p>
<div class="line-block">
<div class="line">If there is no channel registration result response from UW/RW, a Ping confirmation timer is issued and a reconnection request is made.</div>
<div class="line">If the ping passes, the channel registration for the status monitoring channel is performed until the channel registration is completed.</div>
</div>
</div></blockquote>
<p><strong>2. Solution</strong></p>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt>Status monitoring channel:</dt><dd><ul>
<li><p>In CRequestUnwinderThread::ThreadProc() method, call to RequestQueryStatus() to request status of RW.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>In CMakeComposeUwRwData::GetURL() method, append create URL for RW query status.</p></li>
<li><p>In CIni_UwRwManager_work::putStatusCannelID() method, append saving channel ID response from RW.</p></li>
<li><p>In CIni_UwRwManager_work::putUnwinderStatus() method, append saving Status for RW.</p></li>
</ul>
</div></blockquote>
<p><strong>3. Detail implementation</strong></p>
<blockquote>
<div><p class="plantuml">
<img src="_images/plantuml-e1f687489f263634fd4a0a9cbddada19dbe6e45e.png" alt="&#64;startuml
skinparam noteBackgroundColor #DDDDDD
skinparam noteBorderColor #666666

autonumber &quot;&lt;b&gt;[000]&quot;
hide footbox
TITLE 300.1 Get the URL to set in XJMF

participant CMakeComposeUwRwData as main
-[#green]&gt;main++: GetURL(int inType, const char* inDeviceName)
    NOTE OVER OF main
        Old implement
    END NOTE
    NOTE OVER OF main #red
        &lt;strike&gt;std::string ReceiverPort = m_IniUnwinderManager.getReceiver_Port();
        &lt;strike&gt;std::string FolderName;
    END NOTE
    OPT &lt;color red&gt;&lt;strike&gt;inType == E_Compose_QueryStatus
        NOTE OVER OF main #red
           &lt;strike&gt;FolderName = m_IniUnwinderManager.getStatus_Folder();
        END NOTE
    ELSE
        NOTE OVER OF main #red
           &lt;strike&gt;FolderName = m_IniUnwinderManager.getResource_Folder();
        END NOTE
    END
    NOTE OVER OF main #green
        std::string ReceiverPort = m_IniUnwinderManager.getReceiver_Port(inDeviceName);
        std::string FolderName;
    END NOTE
    OPT &lt;color green&gt;inType == E_Compose_QueryStatus
        NOTE OVER OF main #green
           FolderName = m_IniUnwinderManager.getStatus_Folder(inDeviceName);
        END NOTE
    ELSE
        NOTE OVER OF main #green
           FolderName = m_IniUnwinderManager.getResource_Folder(inDeviceName);
        END NOTE
    END
    NOTE OVER OF main
        Old implement
    END NOTE
&lt;--main--: URL
&#64;enduml"/>
</p>
<p class="plantuml">
<img src="_images/plantuml-b2b66b62de79568ca7060be231178336da58dbd8.png" alt="&#64;startuml
skinparam noteBackgroundColor #DDDDDD
skinparam noteBorderColor #666666

autonumber &quot;&lt;b&gt;[000]&quot;
hide footbox
TITLE 300.2 Save channel ID

participant CIni_UwRwManager_work as main
-[#green]&gt;main++: putStatusCannelID( const std::string&amp; inCannelID, \nconst char* inDeviceName)
    NOTE OVER OF main #red
        &lt;strike&gt;return WriteValueString(&quot;CHANNEL_UW&quot;, &quot;Status_CannelID&quot;, inCannelID.c_str());
    END NOTE

    NOTE OVER OF main #green
        return WriteValueString(std::string(&quot;CHANNEL_&quot;).append(inDeviceName).c_str(), &quot;Status_CannelID&quot;, inCannelID.c_str());
    END NOTE
&lt;--main--:
&#64;enduml"/>
</p>
<p class="plantuml">
<img src="_images/plantuml-c0f606a8fafe19d5c6438c0a54ab79e7880e013f.png" alt="&#64;startuml
skinparam noteBackgroundColor #DDDDDD
skinparam noteBorderColor #666666

autonumber &quot;&lt;b&gt;[000]&quot;
hide footbox
TITLE 300.3 Save status of Unwinder

participant CIni_UwRwManager_work as main
-[#green]&gt;main++: putUnwinderStatus( const std::string&amp; inStatus, const char* inDeviceName)
    NOTE OVER OF main #red
        &lt;strike&gt;return WriteValueString(&quot;STATUS_INFO_UW&quot;, &quot;Status&quot;, inStatus.c_str());
    END NOTE

    NOTE OVER OF main #green
        return WriteValueString(std::string(&quot;STATUS_INFO_&quot;).append(inDeviceName).c_str(), &quot;Status&quot;, inStatus.c_str());
    END NOTE
&lt;--main--:
&#64;enduml"/>
</p>
</div></blockquote>
</div></blockquote>
</section>
<section id="status-monitoring-channel-channel-deletion">
<h2><strong>301. Status monitoring channel (channel deletion)</strong><a class="headerlink" href="#status-monitoring-channel-channel-deletion" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><p><strong>1. Description</strong></p>
<blockquote>
<div><p>301-01.</p>
<p>Deletion of the registered channel is performed by notifying the UW/RW of the “StopPresChParam” command from the controller.</p>
<blockquote>
<div><ul class="simple">
<li><p>Specify the channel ID at the time of channel registration to “ChannelID” of the “StopPresChParam” command</p></li>
<li><p>Obtain the channel ID when registering a channel from “Status_CannelID” in “TP-UWRW_Communication_work.ini”</p></li>
<li><p>When receiving a successful channel deletion response, also delete “Status_CannelID” in “TP-UWRW_Communication_work.ini” (store a empty value).</p></li>
</ul>
</div></blockquote>
<p>301-02.</p>
<p>When registering a channel, if the channel information has already been registered, delete the channel first.</p>
<blockquote>
<div><ul class="simple">
<li><p>Applicable when there is a value in “Status_CannelID” in “TP-UWRW_Communication_work.ini”</p></li>
</ul>
</div></blockquote>
<p>301-03.</p>
<blockquote>
<div><ul class="simple">
<li><p>When the controller ends, delete the channel first.</p></li>
</ul>
</div></blockquote>
</div></blockquote>
<p><strong>2. Solution</strong></p>
<blockquote>
<div><ul class="simple">
<li><p>In CIni_UwRwManager_work::putStatusCannelID method, append set Status_CannelID for RW.</p></li>
<li><p>In CRequestUwRwThread::ThreadProc() method, check for existing channel IDs in TP-UW_Communication_work.ini and delete them.</p></li>
<li><p>In CRequestUwRwThread::CheckEvents() method, when WM_TIMER message is received, delete the channel IDs in TP-UWRW_Communication_work.ini file.</p></li>
<li><p>In CRequestUwRwThread::ThreadProc() method, wait for process “UWandRW_Receiver.exe” to end or m_ExitThread set.</p></li>
<li><p>In CRequestUwRwThread::ThreadProc() method, call to RequestStopPersChParams() for channel which has been registered.</p></li>
</ul>
</div></blockquote>
<p><strong>3. Detail implementation</strong></p>
<blockquote>
<div><p class="plantuml">
<img src="_images/plantuml-74e5bfe67055d9b79418c5700c3fdf77a65331db.png" alt="&#64;startuml
skinparam noteBackgroundColor #DDDDDD
skinparam noteBorderColor #666666

autonumber &quot;&lt;b&gt;[000]&quot;
hide footbox
TITLE 301.1 Set status monitoring channel ID

participant CIni_UwRwManager_work as main
-[#green]&gt;main++: PutStatusCannelID(const std::string&amp; inCannelID, const char* inDeviceName)
    NOTE OVER OF main #red
        &lt;strike&gt;return WriteValueString(&quot;CHANNEL&quot;, &quot;Status_CannelID&quot;, inCannelID.c_str());
    END NOTE

    NOTE OVER OF main #green
        return WriteValueString(std::string(&quot;CHANNEL_&quot;).append(inDeviceName).c_str(), &quot;Status_CannelID&quot;, inCannelID.c_str());
    END NOTE
&lt;--main--:
&#64;enduml"/>
</p>
<p class="plantuml">
<img src="_images/plantuml-2502fbfb955aac9bbbe0151e338de4dcb7042a32.png" alt="&#64;startuml
skinparam noteBackgroundColor #DDDDDD
skinparam noteBorderColor #666666

autonumber &quot;&lt;b&gt;[000]&quot;
hide footbox
TITLE 301.2 Delete channel ID

participant CRequestUwRwThread as main
-[#green]&gt;main++: CheckEvents()
    NOTE OVER OF main
        Old implement
    END NOTE
    NOTE OVER OF main #red
        &lt;strike&gt;m_dataIF-&gt;PutStatusCannelID(&quot;&quot;);
                            &lt;strike&gt;m_dataIF-&gt;PutResourceCannelID(&quot;&quot;);
    END NOTE

    NOTE OVER OF main #green
        m_dataIF-&gt;PutStatusCannelID(&quot;&quot;, m_DeviceName);
        m_dataIF-&gt;PutResourceCannelID(&quot;&quot;, m_DeviceName);
    END NOTE
&lt;--main--:
&#64;enduml"/>
</p>
<p class="plantuml">
<img src="_images/plantuml-a16eac12b224aba2634912933692532300322491.png" alt="&#64;startuml
skinparam noteBackgroundColor #DDDDDD
skinparam noteBorderColor #666666

autonumber &quot;&lt;b&gt;[000]&quot;
hide footbox
TITLE 301.3 Create transmission data for channel deletion (Stop PersChParams)

participant CMakeComposeUwRwData as main
-[#green]&gt;main++: ParameterStopPersChParams(int \ninType, const char* inDeviceName)
    NOTE OVER OF main
        Old implement
    END NOTE
    NOTE OVER OF main #red
        &lt;strike&gt;NameValueTable[&quot;ChannelID&quot;]                 = GetChannelID(inType);
        &lt;strike&gt;NameValueTable[&quot;MessageType&quot;]               = GetMessageType();
        &lt;strike&gt;NameValueTable[&quot;URL&quot;]                               = GetURL(inType );
    END NOTE

    NOTE OVER OF main #green
        NameValueTable[&quot;ChannelID&quot;]                 = GetChannelID(inType, inDeviceName);
        NameValueTable[&quot;MessageType&quot;]               = GetMessageType();
        NameValueTable[&quot;URL&quot;]                               = GetURL(inType, inDeviceName);
    END NOTE
    NOTE OVER OF main
        Old implement
    END NOTE
&lt;--main--:
&#64;enduml"/>
</p>
<p class="plantuml">
<img src="_images/plantuml-266705331213c350598d21049b5add56223470b8.png" alt="&#64;startuml
skinparam noteBackgroundColor #DDDDDD
skinparam noteBorderColor #666666

autonumber &quot;&lt;b&gt;[000]&quot;
hide footbox
TITLE 301.4 Request stop PersChParams

participant CRequestUwRw as main
-&gt;main++: RequestStopPersChParams(int inStopType)
    NOTE OVER OF main
        Old implement
    END NOTE
    NOTE OVER OF main #red
        &lt;strike&gt;UwXjmfDataMap sUwSendDataMap = m_UnwinderData-&gt;ParameterStopPersChParams(inStopType);
    END NOTE

    NOTE OVER OF main #green
        UwXjmfDataMap sUwSendDataMap = m_UnwinderData-&gt;ParameterStopPersChParams(inStopType, m_Thread-&gt;getDevicename());
    END NOTE
    NOTE OVER OF main
        Old implement
    END NOTE
    NOTE OVER OF main #red
        &lt;strike&gt;m_UnwinderData-&gt;PutStatusCannelID(CannelID);
    END NOTE

    NOTE OVER OF main #green
        m_UnwinderData-&gt;PutStatusCannelID(CannelID, m_Thread-&gt;getDevicename());
    END NOTE
    NOTE OVER OF main
        Old implement
    END NOTE
&lt;--main--: ResultData
&#64;enduml"/>
</p>
</div></blockquote>
</div></blockquote>
</section>
<section id="status-monitoring-channel-receiving-periodic-notifications">
<h2><strong>302. Status monitoring channel (receiving periodic notifications)</strong><a class="headerlink" href="#status-monitoring-channel-receiving-periodic-notifications" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><p><strong>1. Description</strong></p>
<blockquote>
<div><p>302-01.</p>
<p>When the channel registration is performed normally, the UW/RW notifies the “SignalStatus” command at the specified interval. The controller receives this.</p>
<p>302-02.</p>
<p>Receive the following information with the “SignalStatus” command from UW/RW and store the information</p>
<blockquote>
<div><ul>
<li><p>DeviceInfo/Status (UW/RW device status)</p>
<blockquote>
<div><ul class="simple">
<li><p>Store the received value in “Status” of “TP-UWRW_Communication_work.ini”</p></li>
<li><p>UW/RW device status list</p></li>
</ul>
<a class="reference internal image-reference" href="_images/302_11.PNG"><img alt="_images/302_11.PNG" src="_images/302_11.PNG" style="width: 90%;" /></a>
</div></blockquote>
</li>
</ul>
</div></blockquote>
<p>302-03.</p>
<p>If there is no “SignalStatus” from the UW/RW after the interval + α seconds specified when the controller registers the status monitoring channel, it determines that the UW/RW has not started.</p>
<blockquote>
<div><ul>
<li><p>+α seconds is defined in the “TP-UWRW_Communication.ini” file.</p></li>
<li><p>At this time, store “” (empty value) in “Status” of “TP-UWRW_Communication_work.ini”</p></li>
<li><p>At this time, the following warning message dialog is displayed.</p>
<blockquote>
<div><ul>
<li><p>For UW</p>
<blockquote>
<div><ul class="simple">
<li><p>(Ja) UWとの通信エラーが発生しました。</p></li>
<li><p>(En) A communication error with UW has occurred.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>For RW</p>
<blockquote>
<div><ul class="simple">
<li><p>(Ja) RWとの通信エラーが発生しました。</p></li>
<li><p>(En) A communication error with RW has occurred.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p>At this time, a Ping confirmation timer is issued and a reconnection request is issued.</p></li>
</ul>
</div></blockquote>
<p>If the ping passes, the channel registration for the status monitoring channel is performed until the channel registration is completed.</p>
</div></blockquote>
<p><strong>2. Solution</strong></p>
<ul>
<li><dl>
<dt>In method CDataIF::UpdateDisplayUWStatus(), post a message about RW status and display the warning dialog when RW is offline</dt><dd><ul>
<li><p>In method CRequestUwRwThread::CheckReceiverRunning(), if UWandRW_Receiver.exe is not run, call method UpdateDisplayUWStatus(false) to display UW offline icon.</p></li>
<li><p>In method CRequestUwRwThread::CheckUWStatus(),</p>
<blockquote>
<div><ul class="simple">
<li><p>If receive the response from RW successfully, call method UpdateDisplayUWStatus(true) to display RW online icon.</p></li>
<li><p>Else, call method UpdateDisplayUWStatus(false) to display RW offline icon.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>In method CReceiveSignalStatus::ReceiveStatusInfo:</p>
<blockquote>
<div><ul class="simple">
<li><p>Stop the current timeout timer and start a new one.</p></li>
<li><p>Set the RW status into UnwinderManager_work.ini file.</p></li>
<li><p>call method UpdateDisplayUWStatus(true) to display RW online icon.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>3. Detail implementation</strong></p>
<blockquote>
<div><p class="plantuml">
<img src="_images/plantuml-904d440d5294b5376841586950be391a500139f8.png" alt="&#64;startuml
skinparam noteBackgroundColor #DDDDDD
skinparam noteBorderColor #666666

autonumber &quot;&lt;b&gt;[000]&quot;
hide footbox
TITLE 302.1 Receive Signal status

participant CReceiveSignalStatus as main
-&gt;main++: ReceiveInfo()
    NOTE OVER OF main
        Old implement
    END NOTE
    NOTE OVER OF main #red
        &lt;strike&gt;hPipe = CreateNamedPipe(&quot;\\\\.\\pipe\\Unwinder&quot;,            //lpName
                                            &lt;strike&gt;//Temporary comment PIPE_ACCESS_INBOUND | FILE_FLAG_OVERLAPPED,            // dwOpenMode
                                            &lt;strike&gt;PIPE_ACCESS_INBOUND,
                                            &lt;strike&gt;PIPE_TYPE_BYTE | PIPE_WAIT,
                                            &lt;strike&gt;1,
                                            &lt;strike&gt;0,
                                            &lt;strike&gt;0,
                                            &lt;strike&gt;100,
                                            &lt;strike&gt;NULL);
    END NOTE

    NOTE OVER OF main #green
        hPipe = CreateNamedPipe(string(&quot;\\\\.\\pipe\\&quot;).append(strcmp(m_RequestThread-&gt;getDevicename(), &quot;RW&quot;) ? &quot;Unwinder&quot; : &quot;Rewinder&quot;).c_str(),           //lpName
                                    //Temporary comment PIPE_ACCESS_INBOUND | FILE_FLAG_OVERLAPPED,            // dwOpenMode
                                    PIPE_ACCESS_INBOUND,
                                    PIPE_TYPE_BYTE | PIPE_WAIT,
                                    1,
                                    0,
                                    0,
                                    100,
                                    NULL);
    END NOTE
    NOTE OVER OF main
        Old implement
    END NOTE
    NOTE OVER OF main #red
        &lt;strike&gt;ss &lt;&lt; &quot;[CReceiveSignalStatus::ReceiveInfo] CreateNamedPipe(\\\\.\\pipe\\Unwinder) Error GetLastError=&quot; &lt;&lt; GetLastError();
    END NOTE

    NOTE OVER OF main #green
        ss &lt;&lt; &quot;[CReceiveSignalStatus::ReceiveInfo] CreateNamedPipe(\\\\.\\pipe\\&quot; &lt;&lt; (strcmp(m_RequestThread-&gt;getDevicename(), &quot;RW&quot;) ? &quot;Unwinder&quot; : &quot;Rewinder&quot;) &lt;&lt;&quot;) Error GetLastError=&quot; &lt;&lt; GetLastError();
    END NOTE
    NOTE OVER OF main
        Old implement
    END NOTE
&lt;--main--: nRet
&#64;enduml"/>
</p>
<p class="plantuml">
<img src="_images/plantuml-92e61d28202397d9ad685d8acd4758549e40969f.png" alt="&#64;startuml
skinparam noteBackgroundColor #DDDDDD
skinparam noteBorderColor #666666

autonumber &quot;&lt;b&gt;[000]&quot;
hide footbox
TITLE 302.3 Save value of Status to ini file

participant CReceiveSignalStatus as main
-&gt;main++: ReceiveStatusInfo( const std::string&amp; inStatus )
    NOTE OVER OF main
        Old implement
    END NOTE
    NOTE OVER OF main #red
        &lt;strike&gt;CIni_UwRwManager_work iniUnwinderManager_work;
        &lt;strike&gt;iniUnwinderManager_work.Initialize(TRUE);
        &lt;strike&gt;iniUnwinderManager_work.putUnwinderStatus(inStatus);
    END NOTE
    NOTE OVER OF main #green
        CIni_UwRwManager_work iniUwRwManager_work;
        iniUwRwManager_work.Initialize(TRUE);
        iniUwRwManager_work.putUwRwStatus(inStatus, m_RequestThread-&gt;getDevicename());
    END NOTE
&lt;--main--: TRUE
&#64;enduml"/>
</p>
</div></blockquote>
</div></blockquote>
</section>
<section id="paper-information-notification-channel-channel-registration">
<h2><strong>400. Paper information notification channel (channel registration)</strong><a class="headerlink" href="#paper-information-notification-channel-channel-registration" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><dl>
<dt><strong>1. Description</strong></dt><dd><p>400-02.</p>
<p>The channel registration timing is set immediately after the controller notify printing condition information to UW/RW by “CommandResource” command and receives a response from the UW when the controller is started.</p>
<p>However, the process of notifying “CommandResource” to UW/RW is will be addressed in the next “Order 3”.</p>
<p>Therefore, at the time of “Order 2”, the channel registration timing shall be the time when the controller starts up.</p>
<p>400-04.</p>
<p>If channel registration is successfully completed (returncode=0 or returncode=18), receive channel ID (refID) in response from UW/RW.</p>
<blockquote>
<div><ul class="simple">
<li><p>Store the received channel ID in “Resource_CannelID” of “TP-UWRW_Communication_work.ini”</p></li>
</ul>
</div></blockquote>
<p>400-05.</p>
<p>In the case of channel registration with UW, the presence or absence of the paper thickness gauge option is obtained from the return code upon completion. Not applicable for channel registration with RW.</p>
<blockquote>
<div><ul class="simple">
<li><p>If returncode=0, determine that there is a paper thickness gauge option, and store 1 in “Enable_ThicknessMeasureOP” of “TP-UWRW_Communication_work.ini”</p></li>
<li><p>If returncode=18, determine that there is no paper thickness gauge option and store 0 in “Enable_ThicknessMeasureOP” of “TP-UWRW_Communication_work.ini”</p></li>
</ul>
</div></blockquote>
</dd>
</dl>
<p><strong>2. Solution</strong></p>
<blockquote>
<div><ul class="simple">
<li><p>In method CRequestUwRwThread::NotifyAndQueryResource(), temporarily comment out call to CRequestUwRw::RequestCommandResource().</p></li>
<li><p>In plugin PrintConditionGUI and JobPrintSequence, temporarily comment out call to SUnwinderManager_Callbacks callback functions.</p></li>
<li><p>In method CRequestUwRw::RequestQueryResource(), store the received channel ID when returncode=18.</p></li>
<li><p>In method CRequestUwRw::RequestQueryResource(), store the received Enable_ThicknessMeasureOP value when returncode=0 or returncode=18.</p></li>
<li><p>In method CIni_UwRwManager_work::putResourceCannelID(), add parameter inDeviceName.</p></li>
<li><p>Add method CIni_UwRwManager_work::putEnable_ThicknessMeasureOP() to store the value to ini file.</p></li>
</ul>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">Ini_UWRWManager_work.h</span><a class="headerlink" href="#id8" title="Permalink to this code">¶</a></div>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// before</span>
<span class="k">class</span><span class="w"> </span><span class="nc">CIni_UwRwManager_work</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">BOOL</span><span class="w"> </span><span class="nf">putResourceCannelID</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">inCannelID</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// after</span>
<span class="k">class</span><span class="w"> </span><span class="nc">CIni_UwRwManager_work</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">BOOL</span><span class="w"> </span><span class="nf">putResourceCannelID</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">inCannelID</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">inDeviceName</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">...</span><span class="w"></span>
<span class="w">    </span><span class="n">BOOL</span><span class="w"> </span><span class="n">putEnable_ThicknessMeasureOP</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">inEnable_ThicknessMeasureOP</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">inDeviceName</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div></blockquote>
<p><strong>3. Detail implementation</strong></p>
<blockquote>
<div><blockquote>
<div><p class="plantuml">
<img src="_images/plantuml-209dd80d154e9e34b24dce19f1ae1ad3d15a24bc.png" alt="&#64;startuml
skinparam noteBackgroundColor #DDDDDD
skinparam noteBorderColor #666666

autonumber &quot;&lt;b&gt;[000]&quot;
hide footbox
TITLE 400.1 Remove CommandResource for Order2

participant CRequestUwRwThread as main
participant CRequestUwRw as req
-&gt; main++: NotifyAndQueryResource(sectionId)
    NOTE over main #red: &lt;strike&gt;CUnwinderPaper unwinderPaper;
    ALT &lt;color red&gt;&lt;strike&gt;sectionId == &quot;&quot;
        main-[#red]&gt; main++: &lt;color red&gt;&lt;strike&gt;GetPrintConditionResourceInfo(&amp;unwinderPaper)
         return
    ELSE
        main-[#red]&gt; main++: &lt;color red&gt;&lt;strike&gt;GetJobResourceInfo(&amp;unwinderPaper, sectionId)
        return
    END
    main-[#red]&gt;req++: &lt;color red&gt;&lt;strike&gt;RequestCommandResource(unwinderPaper)
    return &lt;color red&gt;&lt;strike&gt;result
    REF OVER main: Old implementation
return
&#64;enduml"/>
</p>
<p class="plantuml">
<img src="_images/plantuml-a523629f9eb0bdebbb6559cfbb2000ea9f86e981.png" alt="&#64;startuml
skinparam noteBackgroundColor #DDDDDD
skinparam noteBorderColor #666666

autonumber &quot;&lt;b&gt;[000]&quot;
hide footbox
TITLE 400.2 Remove channel registration when switching current print condition

participant &quot;PrintConditionGUI\CDataIF&quot; as data1
participant SUnwinderManager_Callbacks as cb
participant Plugin_IF as plugin
-&gt; data1++: SetCurrentPrintCondition()
    NOTE over data1: Old implementation
    data1-[#red]&gt;plugin++: &lt;color red&gt;&lt;strike&gt;_UnwinderManager_GetCallbacks()
        create cb
        plugin-[#red]&gt;cb: &lt;color  red&gt;&lt;strike&gt; create
    return &lt;color red&gt;&lt;strike&gt;callback
    data1-[#red]&gt;cb++: &lt;color red&gt;&lt;strike&gt;OnSetCurrentPrintCondition()
    return
return
&#64;enduml"/>
</p>
<p class="plantuml">
<img src="_images/plantuml-c8038c29f7e1d2c8b85cd13d832c6fe992229b43.png" alt="&#64;startuml
skinparam noteBackgroundColor #DDDDDD
skinparam noteBorderColor #666666

autonumber &quot;&lt;b&gt;[000]&quot;
hide footbox
TITLE 400.3 Remove channel registration when changing the current print condition setting

participant &quot;PrintConditionGUI\CDataIF&quot; as data1
participant SUnwinderManager_Callbacks as cb
participant Plugin_IF as plugin
-&gt; data1++: SavePrintCondition()
    NOTE over data1: Old implementation
    NOTE over data1 #red
        &lt;strike&gt;bool selecting = false;
        &lt;strike&gt;const char* printConditionName = NULL;
        &lt;strike&gt;bool ret = m_PrintSettings-&gt;GetCurrentPrintCondition(
        &lt;strike&gt;&amp;selecting, &amp;printConditionName);
    END NOTE
    OPT &lt;color red&gt;&lt;strike&gt;ret == TRUE &amp;&amp; selecting == TRUE
        data1-[#red]&gt;plugin++: &lt;color red&gt;&lt;strike&gt;_UnwinderManager_GetCallbacks()
            create cb
            plugin-[#red]&gt;cb: &lt;color  red&gt;&lt;strike&gt; create
        return &lt;color red&gt;&lt;strike&gt;callback
        data1-[#red]&gt;cb++: &lt;color red&gt;&lt;strike&gt;OnUpdateCurrentPrintCondition()
        return
    END
return
&#64;enduml"/>
</p>
<p class="plantuml">
<img src="_images/plantuml-a9929a258ad8ae3218059f9b60b83648c5c8f7a8.png" alt="&#64;startuml
skinparam noteBackgroundColor #DDDDDD
skinparam noteBorderColor #666666

autonumber &quot;&lt;b&gt;[000]&quot;
hide footbox
TITLE 400.4 Remove channel registration when job is running

participant &quot;JobPrintSequence\JobPrintManager&quot; as proc
participant SUnwinderManager_Callbacks as cb
participant Plugin_IF as plugin
-&gt; proc++: runJob(\nbool inIsFirstJob,\nbool inIsJobPrintStartButtonPushed)
    NOTE over proc: Old implementation
    OPT getSectionIDOfTopJob(&amp;jobManagerCb, sectionID) == TRUE
        proc-[#red]&gt;plugin++: &lt;color red&gt;&lt;strike&gt;_UnwinderManager_GetCallbacks()
            create cb
            plugin-[#red]&gt;cb: &lt;color red&gt;&lt;strike&gt;create
        return &lt;color red&gt;&lt;strike&gt;callback
        proc-[#red]&gt;cb++: &lt;color red&gt;&lt;strike&gt;OnFirstJobRunsectionID()
        return
    END
    NOTE over proc: Old implementation
return
&#64;enduml"/>
</p>
<p class="plantuml">
<img src="_images/plantuml-cb0b0ab7e9b8e7519768b1cb9333de1d582a2690.png" alt="&#64;startuml
skinparam noteBackgroundColor #DDDDDD
skinparam noteBorderColor #666666

autonumber &quot;&lt;b&gt;[000]&quot;
hide footbox
TITLE 400.5 Remove channel registration when the job running status is released

participant &quot;JobPrintSequence\JobPrintManager&quot; as proc
participant &quot;SUnwinderManager_Callbacks&quot; as cb
participant Plugin_IF as plugin
-&gt; proc++: ProStartJobPrintSeq()
    NOTE over proc: Old implementation
    proc-[#red]&gt;plugin++: &lt;color red&gt;&lt;strike&gt;_UnwinderManager_GetCallbacks()
        create cb
        plugin-[#red]&gt;cb: &lt;color red&gt;&lt;strike&gt;create
    return &lt;color red&gt;&lt;strike&gt;callback
    proc-[#red]&gt;cb++: &lt;color red&gt;&lt;strike&gt;OnEndJobRun();
    return
    NOTE over proc: Old implementation
return
&#64;enduml"/>
</p>
</div></blockquote>
<p class="plantuml">
<img src="_images/plantuml-f054b317e39cc22d965c7fcb89dc337b64d4751b.png" alt="&#64;startuml
skinparam noteBackgroundColor #DDDDDD
skinparam noteBorderColor #666666

autonumber &quot;&lt;b&gt;[000]&quot;
hide footbox
TITLE 400.6 Register paper information notification channel

participant CRequestUwRwThread as main
participant CRequestUwRw as req
participant CIni_UwRwManager_work as ini
-&gt; main++: NotifyAndQueryResource()
    main-&gt;req++: RequestQueryResource()
        NOTE over req: ...
        OPT &lt;color red&gt;&lt;strike&gt;ReturnCode == &quot;0&quot;
            req -[#red]&gt;ini++: &lt;color red&gt;&lt;strike&gt;PutResourceCannelID(channelID)
            return
        END
        OPT &lt;color green&gt;ReturnCode == &quot;0&quot; || ReturnCode == &quot;18&quot;
            req -[#green]&gt;ini++: &lt;color green&gt;PutResourceCannelID(channelID, m_DeviceName)
            return
        END
    return result
    OPT result.find(&quot;[SUCCESS]&quot;) != std::string::npos
        NOTE OVER main
            Old implementation
        END NOTE
        OPT &lt;color green&gt; m_DeviceName == &quot;UW&quot;
            ALT &lt;color green&gt;ReturnCode == &quot;0&quot;
                req -[#green]&gt;ini++: &lt;color green&gt;PutEnable_ThicknessMeasureOP(&quot;1&quot;, m_DeviceName)
                return
            ELSE &lt;color green&gt;ReturnCode == &quot;18&quot;
                req -[#green]&gt;ini++: &lt;color green&gt;PutEnable_ThicknessMeasureOP(&quot;0&quot;, m_DeviceName)
                return
            END
        END
    END
return
&#64;enduml"/>
</p>
</div></blockquote>
</div></blockquote>
</section>
<section id="paper-information-notification-channel-channel-deletion">
<h2><strong>401. Paper information notification channel(channel deletion)</strong><a class="headerlink" href="#paper-information-notification-channel-channel-deletion" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><p><strong>1. Description</strong></p>
<blockquote>
<div><p>401-01.</p>
<p>Deletion of the registered channel is performed by notifying the UW/RW of the “StopPresChParam” command from the controller.</p>
<blockquote>
<div><ul class="simple">
<li><p>Specify the channel ID at the time of channel registration to “ChannelID” of the “StopPresChParam” command</p></li>
<li><p>Obtain the channel ID when registering a channel from “Status_CannelID” in “TP-UWRW_Communication_work.ini”</p></li>
<li><p>When receiving a successful channel deletion response, also delete “Status_CannelID” in “TP-UWRW_Communication_work.ini” (store a empty value).</p></li>
</ul>
</div></blockquote>
<p>401-02.</p>
<p>When registering a channel, if the channel information has already been registered, delete the channel first.</p>
<blockquote>
<div><ul class="simple">
<li><p>Applicable when there is a value in “Status_CannelID” in “TP-UWRW_Communication_work.ini”</p></li>
</ul>
</div></blockquote>
<p>401-03.
When the controller ends, delete the channel first.</p>
</div></blockquote>
<p><strong>2. Solution</strong></p>
<blockquote>
<div><ul class="simple">
<li><p>In CRequestUwRwThread::ThreadProc(), CRequestUwRwThread::CheckEvents(), and CRequestUwRw::RequestStopPersChParams(), update the call to CIni_UwRwManager_work::putResourceCannelID() with DeviceName.</p></li>
</ul>
</div></blockquote>
<p><strong>3. Detail implementation</strong></p>
<p class="plantuml">
<img src="_images/plantuml-c49eb76b4108c98b4feaff83a1cf9f0307ae6d2a.png" alt="&#64;startuml
skinparam noteBackgroundColor #DDDDDD
skinparam noteBorderColor #666666

autonumber &quot;&lt;b&gt;[000]&quot;
hide footbox
TITLE 401.1 Delete channels when controller starts

participant CRequestUWRWThread as main
participant CIni_UwRwManager_work as ini
-&gt; main++: ThreadProc()
    NOTE over main: Old implementation
    main-[#red]&gt; ini++: &lt;color red&gt;&lt;strike&gt;putResourceCannelID(&quot;&quot;)
    return
    main-[#green]&gt; ini++: &lt;color green&gt;putResourceCannelID(&quot;&quot;, m_DeviceName)
    return
    NOTE over main: Old implementation
return
&#64;enduml"/>
</p>
<p class="plantuml">
<img src="_images/plantuml-bb30afa5526eb11ca3e7c1826a5a38aafdba3bc4.png" alt="&#64;startuml
skinparam noteBackgroundColor #DDDDDD
skinparam noteBorderColor #666666

autonumber &quot;&lt;b&gt;[000]&quot;
hide footbox
TITLE 401.2 Delete channels when not receiving signal resource

participant CRequestUwRwThread as main
participant CIni_UwRwManager_work as ini
-&gt; main++: CheckEvents()
NOTE over main: Old implementation
main-[#red]&gt; ini++: &lt;color red&gt;&lt;strike&gt;putResourceCannelID(&quot;&quot;)
return
main-[#green]&gt; ini++: &lt;color green&gt;putResourceCannelID(&quot;&quot;, m_DeviceName)
return
NOTE over main: Old implementation
return
&#64;enduml"/>
</p>
<p class="plantuml">
<img src="_images/plantuml-8e770793977e3411f899dea3ad93ef2684076669.png" alt="&#64;startuml
skinparam noteBackgroundColor #DDDDDD
skinparam noteBorderColor #666666

autonumber &quot;&lt;b&gt;[000]&quot;
hide footbox
TITLE 401.3 Delete channels when controller ends

participant CRequestUwRw as main
participant CIni_UwRwManager_work as ini
-&gt; main++: RequestStopPersChParams(\t\nE_Compose_QueryResource)
    NOTE over main: Old implementation
    main-[#red]&gt; ini++: &lt;color red&gt;&lt;strike&gt;putResourceCannelID(&quot;&quot;)
    return
    main-[#green]&gt; ini++: &lt;color green&gt;putResourceCannelID(&quot;&quot;, m_DeviceName)
    return
return
&#64;enduml"/>
</p>
</div></blockquote>
</section>
<section id="paper-information-notification-channel-receiving-periodic-notifications">
<h2><strong>402. Paper information notification channel (receiving periodic notifications)</strong><a class="headerlink" href="#paper-information-notification-channel-receiving-periodic-notifications" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><p><strong>1. Description</strong></p>
<blockquote>
<div><p>402-02.</p>
<p>Receive the following information with the “SignalResouce” command from UW/RW, store necessary information in “TP-UWRW_Communication_work.ini”</p>
<blockquote>
<div><ul>
<li><p>Receive but do not need to store</p>
<blockquote>
<div><ul class="simple">
<li><p>Resource/Dimension.X (UW/RW paper width)</p></li>
<li><p>Resource/MediaType (UW/RW media name)</p></li>
<li><p>Resource/Weight (UW/RW paper weight)</p></li>
<li><p>Resource/Thickness (UW/RW paper thickness)</p></li>
<li><p>Resource/UWDancerWebTension (UW dancer web tension)</p></li>
<li><p>Resource/RWDancerWebTension (RW dancer web tension)</p></li>
<li><p>Resource/RWWindingTension (RW winding tension)</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Items that need to be stored</p>
<blockquote>
<div><ul class="simple">
<li><p>Resource/Dimension.Y (for UW: remaining amount of paper, for RW: windable amount of paper)</p></li>
<li><p>Resource/scr:RollDiameter (UW/RW roll diameter)</p></li>
<li><p>Resource/scr:StopRollDiameter (UW/RW stop roll diameter)</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
<p>402-03.</p>
<p>Regarding 402-02, for the information that the value of “-1” was notified in “SignalResouce” from UW/RW, do not store the received information in “TP-UWRW_Communication_work.ini”.</p>
<blockquote>
<div><ul class="simple">
<li><p>① UW/RW hides the remaining amount of paper on the operation panel when the roll is not set, and notifies the TP of -1 using “SignalResouce”.</p></li>
<li><p>② UW/RW calculates the approximate amount of remaining paper immediately after the roll is set or the power is turned on, and displays it on the operation panel. At this time, the TP is notified to -1 by ‘SignalResource”.</p></li>
<li><p>③ When roll transport is performed, the final value for the remaining amount of paper is calculated, the display on the operation panel is updated, and the final value for the remaining amount of paper is notified to the TP by “SignalResource”.</p></li>
</ul>
</div></blockquote>
<p>402-04.</p>
<p>If there is no “SignalResouce” from the UW/RW after the interval + α seconds specified when the controller registers the status monitoring channel, it determines that the UW/RW has not started.</p>
<blockquote>
<div><ul>
<li><p>+α seconds is defined in the “TP-UWRW_Communication.ini” file.</p></li>
<li><p>At this time, the following warning message dialog is displayed.</p>
<blockquote>
<div><ul>
<li><p>For UW</p>
<blockquote>
<div><ul class="simple">
<li><p>(Ja) UWとの通信エラーが発生しました。</p></li>
<li><p>(En) A communication error with UW has occurred.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>For RW</p>
<blockquote>
<div><ul class="simple">
<li><p>(Ja) RWとの通信エラーが発生しました。</p></li>
<li><p>(En) A communication error with RW has occurred.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>At this time, a Ping confirmation timer is issued and a reconnection request is issued.</p></li>
</ul>
<p>If the ping passes, the channel registration for the status monitoring channel is performed until the channel registration is completed.</p>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</div></blockquote>
<p><strong>2. Solution</strong></p>
<ul class="simple">
<li><p>In method CIni_UwRwManager_work::putPaperRollDiameter(), CIni_UwRwManager_work::putPaperRemainingAmount(), add inDeviceName parameter.</p></li>
<li><p>Add method CIni_UwRwManager_work::putPaperStopRollDiameter() to save StopRollDiameter information.</p></li>
</ul>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">Ini_UWRWManager_work.h</span><a class="headerlink" href="#id9" title="Permalink to this code">¶</a></div>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// before</span>
<span class="k">class</span><span class="w"> </span><span class="nc">CIni_UwRwManager_work</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">BOOL</span><span class="w"> </span><span class="nf">putPaperRollDiameter</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">inRollDiameter</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">BOOL</span><span class="w"> </span><span class="nf">putPaperRemainingAmount</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">inRemainingAmount</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// after</span>
<span class="k">class</span><span class="w"> </span><span class="nc">CIni_UwRwManager_work</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">BOOL</span><span class="w"> </span><span class="nf">putPaperRollDiameter</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">inRollDiameter</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">inDeviceName</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">BOOL</span><span class="w"> </span><span class="nf">putPaperRemainingAmount</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">inRemainingAmount</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">inDeviceName</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">BOOL</span><span class="w"> </span><span class="nf">putPaperStopRollDiameter</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">inRollDiameter</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">inDeviceName</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<ul class="simple">
<li><p>Update method CXmlParse::ParseSignalStatus() to put more information to map: Weight, StopRollDiameter, UWWebTension, RWWebTension, RWRollTension.</p></li>
<li><p>Update method CReceiveSignalStatus::AnalyzeData() with above additional information.</p></li>
<li><p>In method CReceiveSignalStatus::ReceivePaperInfo(), add parameters for above additional information.</p></li>
<li><p>In method CReceiveSignalStatus::ReceivePaperInfo(), if values are -1, do not store them to ini file.</p></li>
</ul>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text">ReceiveSignalStatus.h</span><a class="headerlink" href="#id10" title="Permalink to this code">¶</a></div>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// before</span>
<span class="k">class</span><span class="w"> </span><span class="nc">CReceiveSignalStatus</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">BOOL</span><span class="w"> </span><span class="n">ReceivePaperInfo</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">inDescriptiveName</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">inDimension</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">inMediaType</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">inRollDiameter</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">inThickness</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// after</span>
<span class="k">class</span><span class="w"> </span><span class="nc">CReceiveSignalStatus</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">BOOL</span><span class="w"> </span><span class="n">ReceivePaperInfo</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">inDescriptiveName</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">inDimension</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">inMediaType</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">inRollDiameter</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">inThickness</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">inWeight</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">inStopRollDiameter</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">inUWWebTension</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">inRWWebTension</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">inRWRollTension</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<p><strong>3. Detail implementation</strong></p>
<blockquote>
<div><p class="plantuml">
<img src="_images/plantuml-b6c97c0d698d1adbeeb08a8783d3b393243ec7ad.png" alt="&#64;startuml
skinparam noteBackgroundColor #DDDDDD
skinparam noteBorderColor #666666

autonumber &quot;&lt;b&gt;[000]&quot;
hide footbox
TITLE 402.1 Parse signal status info notified from UWandRW_Receiver

participant CXmlParse as main

-&gt; main++: ParseSignalStatus(MSXML2::IXMLDOMNodePtr inNode)
    NOTE OVER of main: Old implementation
    NOTE OVER of main
        pElement_Media-&gt;getAttribute(L&quot;Thickness&quot;,&amp;val);
        if ( val.vt != VT_NULL )
        {
            bstr = val;
            m_UwXjmfDataMap[&quot;Thickness&quot;] = bstr;
        }
    END NOTE
    NOTE OVER of main #green
        pElement_Media-&gt;getAttribute(L&quot;Weight&quot;,&amp;val);
        if ( val.vt != VT_NULL )
        {
            bstr = val;
            m_UwXjmfDataMap[&quot;Weight&quot;] = bstr;
        }
        pElement_Media-&gt;getAttribute(L&quot;scr:StopRollDiameter&quot;,&amp;val);
        if ( val.vt != VT_NULL )
        {
            bstr = val;
            m_UwXjmfDataMap[&quot;StopRollDiameter&quot;] = bstr;
        }
        pElement_Media-&gt;getAttribute(L&quot;scr:UWWebTension&quot;,&amp;val);
        if ( val.vt != VT_NULL )
        {
            bstr = val;
            m_UwXjmfDataMap[&quot;UWWebTension&quot;] = bstr;
        }
        pElement_Media-&gt;getAttribute(L&quot;scr:RWWebTension&quot;,&amp;val);
        if ( val.vt != VT_NULL )
        {
            bstr = val;
            m_UwXjmfDataMap[&quot;RWWebTension&quot;] = bstr;
        }
        pElement_Media-&gt;getAttribute(L&quot;scr:RWRollTension&quot;,&amp;val);
        if ( val.vt != VT_NULL )
        {
            bstr = val;
            m_UwXjmfDataMap[&quot;RWRollTension&quot;] = bstr;
        }
    END NOTE
    NOTE OVER of main: Old implementation
return
&#64;enduml"/>
</p>
<p class="plantuml">
<img src="_images/plantuml-1d2237a78e27dd782b9d047b1ba42bc43793c41b.png" alt="&#64;startuml
skinparam noteBackgroundColor #DDDDDD
skinparam noteBorderColor #666666

autonumber &quot;&lt;b&gt;[000]&quot;
hide footbox
TITLE 402.2 Analyze signal status info notified from UWandRW_Receiver

participant CReceiveSignalStatus as main

-&gt; main++: AnalyzeData( std::string&amp; inXmldata )
    NOTE OVER of main: Old implementation
    NOTE OVER of main
        std::string Thickness = sUwXjmfDataMap[&quot;Thickness&quot;];
    END NOTE
    NOTE OVER of main #green
        std::string Weight = sUwXjmfDataMap[&quot;Weight&quot;];
        std::string StopRollDiameter = sUwXjmfDataMap[&quot;StopRollDiameter&quot;];
        std::string UWWebTension = sUwXjmfDataMap[&quot;UWWebTension&quot;];
        std::string RWWebTension = sUwXjmfDataMap[&quot;RWWebTension&quot;];
        std::string RWRollTension = sUwXjmfDataMap[&quot;RWRollTension&quot;];
    END NOTE
    main-[#red]&gt;main++: &lt;color red&gt;&lt;strike&gt;ReceivePaperInfo(DescriptiveName,Dimension,\t\n&lt;color red&gt;&lt;strike&gt;MediaType,RollDiameter,Thickness)
    return
    main-[#green]&gt;main++: &lt;color green&gt;ReceivePaperInfo(DescriptiveName,Dimension,\t\n&lt;color green&gt;MediaType,RollDiameter,Thickness,\t\n&lt;color green&gt;Weight, StopRollDiameter, UWWebTension,\t\n&lt;color green&gt;RWWebTension, RWRollTension)
        NOTE OVER of main #green: Refer to 402.3
    return
    NOTE OVER of main: Old implementation
return
&#64;enduml"/>
</p>
<p class="plantuml">
<img src="_images/plantuml-ad70036688e6da575d692589efb4b4e02ddfd6cf.png" alt="&#64;startuml
skinparam noteBackgroundColor #DDDDDD
skinparam noteBorderColor #666666

autonumber &quot;&lt;b&gt;[000]&quot;
hide footbox
TITLE 402.3 Processing when the paper info is received

participant CReceiveSignalStatus as main
participant CIni_UwRwManager_work as ini

-&gt; main++: ReceivePaperInfo( const std::string&amp; inDescriptiveName,\n\tconst std::string&amp; inDimension,\n\tconst std::string&amp; inMediaType,\n\tconst std::string&amp; inRollDiameter,\n\tconst std::string&amp; inThickness,\n\t&lt;color green&gt;const std::string&amp; inWeight,\n\t&lt;color green&gt;const std::string&amp; inStopRollDiameter,\n\t&lt;color green&gt;const std::string&amp; inUWWebTension,\n\t&lt;color green&gt;const std::string&amp; inRWWebTension,\n\t&lt;color green&gt;const std::string&amp; inRWRollTension )
    NOTE OVER of main: Old implementation
    main-[#red]&gt;ini++: &lt;color red&gt;&lt;strike&gt;putPaperRollDiameter(inRollDiameter)
    return
    OPT &lt;color green&gt;inRollDiameter != &quot;-1&quot;
        main-[#green]&gt;ini++: &lt;color green&gt;putPaperRollDiameter(inRollDiameter, m_DeviceName)
        return
    END
    NOTE OVER of main: Old implementation
    NOTE OVER of main #red: &lt;strike&gt;m_paperRemainingAmount = atol(vDimension.at(1).c_str());
    main-[#red]&gt;ini++: &lt;color red&gt;&lt;strike&gt;putPaperRemainingAmount(vDimension.at(1))
    return
    NOTE OVER of main #green: const std::string&amp; paperRemainingAmount = vDimension.at(1);
    OPT &lt;color green&gt;paperRemainingAmount != &quot;-1&quot;
        NOTE OVER of main #green: m_paperRemainingAmount = atol(paperRemainingAmount.c_str());
        main-[#green]&gt;ini++: &lt;color green&gt;putPaperRemainingAmount(paperRemainingAmount, m_DeviceName)
        return
    END
    OPT &lt;color green&gt;inStopRollDiameter != &quot;-1&quot;
        main-[#green]&gt;ini++: &lt;color green&gt;putPaperStopRollDiameter(inStopRollDiameter, m_DeviceName)
        return
    END
    NOTE OVER of main: Old implementation
return
&#64;enduml"/>
</p>
</div></blockquote>
</div></blockquote>
</section>
</section>


          </div>
          
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, GCS.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>